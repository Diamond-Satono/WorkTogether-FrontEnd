<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>团队协作平台</title>
    <link rel="stylesheet" href="role.css">
    <script src="https://kit.fontawesome.com/d9129f72c7.js" crossorigin="anonymous"></script>
</head>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Select the submenu parent link
        var submenuParent = document.querySelector('.submenu > a');
        // Find the nested submenu
        var submenu = submenuParent.nextElementSibling;

        // Add 'active' class to parent li
        submenuParent.parentElement.classList.add('active');

        // Rotate the arrow icon
        var arrow = submenuParent.querySelector('.arrow');
        arrow.classList.remove('fa-chevron-right');
        arrow.classList.add('fa-chevron-down');

        // 选择查询按钮
        var queryButton = document.querySelector('.btn-primary');

        // 添加点击事件监听器
        queryButton.addEventListener('click', function () {
            // 获取输入框中的关键字
            var keyword = document.querySelector('.search-box input[type="text"]').value.trim().toLowerCase();

            // 获取所有的表格行
            var rows = document.querySelectorAll('tbody tr');

            // 遍历每一行
            rows.forEach(function (row) {
                // 获取当前行的角色名称单元格的内容
                var roleName = row.querySelector('td:nth-child(2)').textContent.trim().toLowerCase();

                // 如果角色名称包含关键字，则显示该行，否则隐藏该行
                if (roleName.includes(keyword)) {
                    row.style.display = 'table-row';
                } else {
                    row.style.display = 'none';
                }
            });
        });

        // 获取数据的URL
        var url = 'https://mock.apifox.com/m1/3618305-0-default/get_role';

        // 发起GET请求获取数据
        fetch(url)
            .then(response => {
                if (!response.ok) {
                    throw new Error('网络错误');
                }
                return response.json();
            })
            .then(data => {
                var tbody = document.querySelector('tbody');
                console.log(data)
                var row = document.createElement('tr');
                row.innerHTML = `
            <td>${data.ID}</td>
            <td>${data.role_name}</td>
            <td>${data.describtion}</td>
            <td>${data.user_num}</td>
            <td>${data.add_time}</td>
            <td><input class="ios-switch" type="checkbox" ${data.status === 1 ? 'checked' : ''}></td>
            <td class="button-container">
                <button class="assign_menu">分配菜单</button>
                <button class="assign_resource">分配资源</button>
                <button class="edit_button">编辑</button>
                <button class="delete_button">删除</button>
            </td>
        `;
                tbody.appendChild(row);
            })
            .catch(error => {
                console.error('发生错误:', error);
            });

    });

    //点击添加后弹窗
    document.addEventListener('DOMContentLoaded', function () {
        var addButton = document.querySelector('.btn-secondary');
        var modal = document.querySelector('.modal');
        var modalBackground = document.querySelector('.modal-background');
        var closeButton = document.querySelector('.close');
        var confirmButton = document.querySelector('.confirm');

        // 打开弹窗
        addButton.addEventListener('click', function () {
            openModal();
        });

        // 关闭弹窗（点击关闭按钮）
        closeButton.addEventListener('click', function () {
            closeModal();
        });

        // 关闭弹窗（点击确认按钮）
        confirmButton.addEventListener('click', function () {
            closeModal();
        });

        function openModal() {
            modal.style.display = 'block';
            modalBackground.style.display = 'block';

            setTimeout(function () {
                modal.style.opacity = '1';
                modalBackground.style.opacity = '1';
            }, 50); // 设置一个小延迟以确保动画生效
        }

        function closeModal() {
            modal.style.opacity = '0';
            modalBackground.style.opacity = '0';

            setTimeout(function () {
                modal.style.display = 'none';
                modalBackground.style.display = 'none';
            }, 300); // 与动画时间保持一致
        }


        // 添加角色
        // 获取确认按钮元素
        var confirmButton = document.querySelector('.confirm');

        // 添加点击事件监听器
        confirmButton.addEventListener('click', function () {
            // 获取当前日期时间
            var currentDate = new Date();
            var year = currentDate.getFullYear();
            var month = ('0' + (currentDate.getMonth() + 1)).slice(-2);
            var day = ('0' + currentDate.getDate()).slice(-2);
            var hours = ('0' + currentDate.getHours()).slice(-2);
            var minutes = ('0' + currentDate.getMinutes()).slice(-2);
            var seconds = ('0' + currentDate.getSeconds()).slice(-2);

            // 构建日期时间字符串
            var formattedDateTime = year + '-' + month + '-' + day + ' ' + hours + ':' + minutes + ':' + seconds;

            // 获取角色名称、描述和状态的输入值
            var roleName = document.querySelector('.rolenameinput').value;
            var description = document.querySelector('.describtioninput').value;
            var status = document.querySelector('input[name="1"]:checked').value;

            // 创建要发送的数据对象
            var data = {
                roleName: roleName,
                description: description,
                status: status,
                dateTime: formattedDateTime
            };

            // 使用Fetch API发送POST请求到API端点
            fetch('api-url', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => {
                    if (response.ok) {
                        // 数据成功发送到服务器
                        console.log('Data sent successfully.');
                        location.reload();//刷新页面
                    } else {
                        // 数据发送失败
                        console.error('Failed to send data to server.');
                    }
                })
                .catch(error => {
                    // 捕获网络错误或其他错误
                    console.error('Error:', error);
                });
        });
    });


</script>


<body>
    <div class="sidebar">
        <!-- Sidebar content as previous with icons using Font Awesome -->
        <ul>
            <li class="submenu">
                <a href="#"><i class="fas fa-shield-alt"></i> 权限 <i class="fas fa-chevron-right arrow"></i></a>
                <ul class="nested">
                    <li><a href="#"><i class="fas fa-users"></i> 用户列表</a></li>
                    <li><a href="#"><i class="fas fa-user-tag"></i> 角色列表</a></li>
                    <li><a href="#"><i class="fas fa-list"></i> 菜单列表</a></li>
                    <li><a href="#"><i class="fas fa-server"></i> 资源列表</a></li>
                </ul>
            </li>
            <!-- Add other submenu items here -->
        </ul>
    </div>
    <div class="top-bar">
        <div class="breadcrumbs">首页 / 权限 / 角色列表</div>
        <div class="teamwork-icon"><i class="fas fa-users-cog"></i></div>
    </div>
    <div class="content">
        <div class="search-filter-box">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="输入角色名">
            </div>
            <button class="btn-primary">查询</button>
        </div>
        <div class="separator"></div>
        <div class="data-list-box">
            <div class="data-list-title"><i class="fas fa-list"></i> 数据列表</div>
            <button class="btn-secondary">添加</button>
        </div>
        <div class="separator"></div>
        <table>
            <!-- Table structure and data -->
            <thead>
                <tr>
                    <th>ID</th>
                    <th>角色名称</th>
                    <th>描述</th>
                    <th>用户数</th>
                    <th>添加时间</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <!-- Sample row -->
                <tr>
                    <td>1</td>
                    <td>管理员</td>
                    <td>查看及管理团队成员</td>
                    <td>1</td>
                    <td>2024-3-25 16:06:35</td>
                    <td>
                        <input class="ios-switch" type="checkbox" checked>
                    </td>
                    <td class="button-container">
                        <button class="assign_menu">分配菜单</button>
                        <button class="assign_resource">分配资源</button>
                        <button class="edit_button">编辑</button>
                        <button class="delete_button">删除</button>
                    </td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>活动管理员</td>
                    <td>发布及管理活动</td>
                    <td>2</td>
                    <td>2024-3-25 16:44:35</td>
                    <td><input class="ios-switch" type="checkbox"></td>
                    <td class="button-container">
                        <button class="assign_menu">分配菜单</button>
                        <button class="assign_resource">分配资源</button>
                        <button class="edit_button">编辑</button>
                        <button class="delete_button">删除</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="modal-background"></div>
    <div class="modal">
        <div class="modal-content">
            <!-- 在这里放置弹窗内容 -->
            <span class="close">&times;</span>
            <p class="add_title">添加角色</p>
            <div class="rolename">
                <span>角色名称:</span>
                <input type="text" class="rolenameinput">
            </div>
            <div class="role_describtion">
                <span>描述:</span>
                <textarea type="text" class="describtioninput"></textarea>
            </div>
            <div class="choosestatus">
                <span>是否启用:</span>
                <input id="yes" type="radio" checked="checked" name="1" /><label for="yes">是</label>
                <input id="no" type="radio" name="1" /><label for="no">否</label>
            </div>
            <div class="confirmbutton">
                <button class="confirm">确定</button>
            </div>
        </div>
    </div>

</body>

</html>